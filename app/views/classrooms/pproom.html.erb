<div class="maincontainer">
  <nav class="site-nav">
    <div class="site-nav-scrollable-container">
      <ul class="site-nav-list">
        <li class="site-nav-list-item"><%= link_to t("home"), "/", :class=> "site-nav-list-item-btn" %></li>
        <li class="site-nav-list-item"><%= link_to t("event.event_page"), "/event/#{@event_uid}", :class=> "site-nav-list-item-btn" %></li>
      </ul>
    </div>
  </nav>
  <div class="site-nav-overlay"></div>
  <div class="content-container">
    <div class="scroll-region">
      <button class="site-nav-logo">M</button>
      <ul id="tabs-titles">
        <li class="tooltip current" data-title="<%= t("classroom.noVNC") %>"><i class="fa fa-desktop"></i></li>
        <li class="tooltip" data-title="<%= t("classroom.terminal") %>"><i class="fa fa-terminal"></i></li>
        <li class="tooltip" data-title="<%= t("classroom.whiteboard") %>"><i class="fa fa-pencil-square-o"></i></li>
      </ul>
      <div class="leftcolumn">
        <ul id="tabs-contents">
          <li>
            <div class="content">
            </div>
          </li> <!-- end li -->
          <li>
            <div class="content">
            </div>
          </li> <!-- end li -->
          <li>
            <div class="content">
            </div>
          </li> <!-- end li -->
        </ul>
      </div>

      <div class="rightcolumn">
        <div id="local">
          <video id="localVideo" muted="muted" autoplay="autoplay"></video>
        </div>
        <div id="remote">
          <video id="remoteVideo" autoplay="autoplay"></video>
        </div>
      </div>
    </div>
  </div> <!-- end content-container -->
</div> <!-- end maincontainer -->

<% content_for :template_js do %>
  <script>
    var body = $('body');
    $('.site-nav-logo').click(function(){
      body.addClass('site-nav-transition site-nav-drawer-open');
    });
    $('.site-nav-overlay').click(function(){
      body.removeClass('site-nav-drawer-open');
      setTimeout(function() {
        body.removeClass('site-nav-transition');
      }, 300);
    });
  </script>

  <script>
    var tabs = $('#tabs-titles li'); //grab tabs
    var contents = $('#tabs-contents li'); //grab contents

    tabs.bind('click',function(){
      contents.hide(); //hide all contents
      tabs.removeClass('current'); //remove 'current' classes
      $(contents[$(this).index()]).show(); //show tab content that matches tab title index
      $(this).addClass('current'); //add current class on clicked tab title
    });
  </script>

  <script type="text/javascript">
    var serverAddress = 'http://96.126.117.202:8095/webrtc';  // Please change it to signaling server's address.
    var p2p=new Woogeen.Peer({
      iceServers : [ {
        urls : ["turn:96.126.117.202:3478?transport=udp","turn:96.126.117.202:3478?transport=tcp"],
        credential : "master",
        username : "aka"
      }, {
        urls : "stun:96.126.117.202"
      } ]
    });  // Initialize a Peer object
    // var roomToken=JSON.stringify({host:serverAddress, id:Utils.getQueryStrings()['roomId']});  // Tokens for join a room.
    var roomId = "<%= @roomname %>";
    var roomToken=JSON.stringify({host:serverAddress, id:roomId});  // Tokens for join a room.
    var localStream = Woogeen.Stream({audio:true,video:true});  // It only initializes a Woogeen.Stream object. Using localStream.init() to initialize stream.
    localStream.addEventListener("access-accepted", function(evt){  // access-accepted event will be triggered when user accepted to use camera/microphone
      attachMediaStream($('#local video').get(0),localStream.stream)  // Show local stream
      p2p.joinRoom(roomToken,localStream);  // Join a chat room.
    });

    $(document).ready(function(){
        p2p.connect(serverAddress,Utils.getQueryStrings()['uId']);  // Connect to peer server.
        localStream.init();  // Initialize local stream.
        //p2p.leaveRoom(roomToken);  // Quit current chat room.
    });

    p2p.addEventListener('stream-subscribed',function(e){  // A remote stream is available.
      $('#remote video').show();
      attachMediaStream($('#remote video').get(0),e.stream.stream);  // Show remote stream.
    });

    p2p.addEventListener('chat-stopped',function(e){  // Chat stopped
      $('#remote video').hide();
    });

    p2p.addEventListener('chat-started',function(e){  // Chat started
      console.log('Video chat is started.');
    });
  </script>
<% end %>